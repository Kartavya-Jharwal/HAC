<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="color-scheme" content="dark">
    <meta name="theme-color" content="#0E0E0E">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>HAC // DASHBOARD</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bai+Jamjuree:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>
    <!-- ═══════════════════════════════════════════════════════════════════════
         TOPBAR
         ═══════════════════════════════════════════════════════════════════════ -->
    <header class="topbar">
        <a href="../index.html" class="topbar__brand">
            <span class="topbar__logo">HAC</span>
            <span class="topbar__label">MEMBER PORTAL</span>
        </a>
        <nav class="topbar__nav">
            <a href="#events" class="topbar__link topbar__link--active">Events</a>
            <a href="#resources" class="topbar__link">Resources</a>
            <a href="./index.html" class="topbar__link">Access Portal</a>
        </nav>
    </header>

    <!-- ═══════════════════════════════════════════════════════════════════════
         DASHBOARD
         ═══════════════════════════════════════════════════════════════════════ -->
    <main class="dashboard">
        <!-- Welcome -->
        <div class="welcome">
            <div>
                <h1 class="welcome__greeting">Welcome back, <span id="welcome-name">Member</span></h1>
                <p class="welcome__subtitle" id="welcome-subtitle">SESSION ACTIVE // HAC-OS v2.0.0</p>
            </div>
            <div class="welcome__status">
                <div class="welcome__status-dot"></div>
                SYSTEM ONLINE
            </div>
        </div>

        <!-- Member Card (compact) -->
        <div class="member-card" id="member-card">
            <div class="member-card__avatar" id="member-avatar">
                <span class="member-card__avatar-placeholder">◉</span>
            </div>
            <div class="member-card__info">
                <div class="member-card__name" id="member-name">HAC MEMBER</div>
                <div class="member-card__meta">
                    <span class="member-card__meta-item">
                        <span class="member-card__meta-label">ID:</span>
                        <span id="member-id">HAC-2025-0001</span>
                    </span>
                    <span class="member-card__meta-item">
                        <span class="member-card__meta-label">CLEARANCE:</span>
                        <span id="member-clearance">BUILDER</span>
                    </span>
                    <span class="member-card__meta-item">
                        <span class="member-card__meta-label">DESIGNATION:</span>
                        <span id="member-designation">AI COLLECTIVE MEMBER</span>
                    </span>
                </div>
            </div>
            <div class="member-card__actions">
                <button class="btn-sm" id="share-card-btn" title="Share your namecard">⎋ SHARE</button>
                <a href="./index.html" class="btn-sm btn-sm--accent">✎ EDIT PROFILE</a>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             UPCOMING EVENTS
             ═══════════════════════════════════════════════════════════════════ -->
        <div id="events">
            <div class="section-header">
                <span class="section-header__title">◈ Upcoming Events</span>
                <span class="section-header__line"></span>
                <span class="section-header__count">2 EVENTS</span>
            </div>

            <div class="events-grid">
                <!-- Event 1: AI Diagrams -->
                <a href="#" class="event-card" id="event-ai-diagrams">
                    <div class="event-card__tag event-card__tag--upcoming">◈ UPCOMING — WORKSHOP</div>
                    <h2 class="event-card__title">AI-Assisted Stunning Diagrams &amp; Charts</h2>
                    <p class="event-card__desc">
                        Learn to create publication-quality diagrams, flowcharts, and data visualizations 
                        using AI tools. From architecture diagrams to infographics — make complex ideas 
                        visual in minutes, not hours.
                    </p>
                    <div class="event-card__details">
                        <span class="event-card__detail">
                            <span class="event-card__detail-icon">◷</span> TBA
                        </span>
                        <span class="event-card__detail">
                            <span class="event-card__detail-icon">◎</span> In-Person
                        </span>
                        <span class="event-card__detail">
                            <span class="event-card__detail-icon">◈</span> All Levels
                        </span>
                    </div>
                    <div class="event-card__footer">
                        <span class="event-card__cta">
                            VIEW MICROSITE <span class="event-card__cta-arrow">→</span>
                        </span>
                        <span class="event-card__spots">OPEN REGISTRATION</span>
                    </div>
                </a>

                <!-- Event 2: Financial Technical Analysis -->
                <a href="#" class="event-card" id="event-fin-ta">
                    <div class="event-card__tag event-card__tag--upcoming">◈ UPCOMING — WORKSHOP</div>
                    <h2 class="event-card__title">Financial Technical Analysis for Traders</h2>
                    <p class="event-card__desc">
                        Designed for finance majors and aspiring traders. Master chart patterns, 
                        indicators, and AI-powered trading analysis. Build your own technical 
                        analysis dashboards and backtest strategies.
                    </p>
                    <div class="event-card__details">
                        <span class="event-card__detail">
                            <span class="event-card__detail-icon">◷</span> TBA
                        </span>
                        <span class="event-card__detail">
                            <span class="event-card__detail-icon">◎</span> In-Person
                        </span>
                        <span class="event-card__detail">
                            <span class="event-card__detail-icon">◈</span> Finance Majors
                        </span>
                    </div>
                    <div class="event-card__footer">
                        <span class="event-card__cta">
                            VIEW MICROSITE <span class="event-card__cta-arrow">→</span>
                        </span>
                        <span class="event-card__spots">OPEN REGISTRATION</span>
                    </div>
                </a>
            </div>
        </div>

        <!-- ═══════════════════════════════════════════════════════════════════
             QUICK LINKS
             ═══════════════════════════════════════════════════════════════════ -->
        <div id="resources">
            <div class="section-header">
                <span class="section-header__title">◈ Resources</span>
                <span class="section-header__line"></span>
            </div>

            <div class="quick-links">
                <a href="../index.html" class="quick-link">
                    <span class="quick-link__icon">◈</span> HAC Homepage
                </a>
                <a href="./index.html" class="quick-link">
                    <span class="quick-link__icon">◉</span> Access Portal
                </a>
                <a href="#" class="quick-link" id="link-share-card">
                    <span class="quick-link__icon">⎋</span> Share Namecard
                </a>
                <a href="#" class="quick-link" id="link-download-card">
                    <span class="quick-link__icon">⤓</span> Download Namecard
                </a>
            </div>
        </div>

        <!-- Footer -->
        <footer class="dashboard-footer">
            HAC-OS v2.0.0 // HULT AI COLLECTIVE // <span id="footer-year">2025</span>
        </footer>
    </main>

    <!-- Hidden canvas for card export -->
    <canvas id="card-export-canvas" style="display:none;"></canvas>

    <script>
    // ═══════════════════════════════════════════════════════════════════════════
    // DASHBOARD LOGIC
    // ═══════════════════════════════════════════════════════════════════════════
    (function () {
        'use strict';

        const STORAGE_KEY = 'hac_profile';

        function loadProfile() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                return data ? JSON.parse(data) : null;
            } catch (e) { return null; }
        }

        function populateDashboard() {
            const profile = loadProfile();
            if (!profile) return;

            const name = profile.name || 'Member';
            const firstName = name.split(' ')[0];

            // Welcome
            const welcomeName = document.getElementById('welcome-name');
            if (welcomeName) welcomeName.textContent = firstName;

            // Member card
            const memberName = document.getElementById('member-name');
            if (memberName) memberName.textContent = name;

            const memberId = document.getElementById('member-id');
            if (memberId) memberId.textContent = profile.memberId || 'HAC-2025-0001';

            const memberClearance = document.getElementById('member-clearance');
            if (memberClearance) memberClearance.textContent = profile.clearance || 'BUILDER';

            const memberDesignation = document.getElementById('member-designation');
            if (memberDesignation) memberDesignation.textContent = profile.designation || 'AI COLLECTIVE MEMBER';

            // Avatar
            if (profile.avatar) {
                const avatarEl = document.getElementById('member-avatar');
                if (avatarEl) {
                    avatarEl.innerHTML = '';
                    const img = document.createElement('img');
                    img.src = profile.avatar;
                    img.alt = 'Profile';
                    avatarEl.appendChild(img);
                }
            }

            // Last login
            if (profile.lastLogin) {
                const sub = document.getElementById('welcome-subtitle');
                const d = new Date(profile.lastLogin);
                const dateStr = d.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' }).toUpperCase();
                if (sub) sub.textContent = `LAST LOGIN ${dateStr} // HAC-OS v2.0.0`;
            }
        }

        // ═══════════════════════════════════════════════════════════════════════
        // NAMECARD EXPORT (same as main.js but standalone)
        // ═══════════════════════════════════════════════════════════════════════
        function generateNamecard(callback) {
            const profile = loadProfile();
            if (!profile) return;

            const canvas = document.getElementById('card-export-canvas');
            if (!canvas) return;

            const DPR = 2;
            const W = 1050 * DPR, H = 600 * DPR;
            canvas.width = W;
            canvas.height = H;
            const ctx = canvas.getContext('2d');
            ctx.scale(DPR, DPR);

            const w = 1050, h = 600;
            const accent = 'rgb(0, 212, 212)';
            const bg = '#0E0E0E';
            const darkPanel = '#111111';
            const textPrimary = '#E8E8E8';
            const textSecondary = '#888888';
            const textDim = '#555555';

            ctx.fillStyle = bg;
            ctx.fillRect(0, 0, w, h);

            // Grid
            ctx.strokeStyle = 'rgba(255,255,255,0.02)';
            ctx.lineWidth = 0.5;
            for (let x = 0; x < w; x += 30) { ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, h); ctx.stroke(); }
            for (let y = 0; y < h; y += 30) { ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(w, y); ctx.stroke(); }

            // Top stripe
            ctx.fillStyle = accent;
            ctx.fillRect(0, 0, w, 6);

            // Header
            ctx.font = 'bold 48px "Bai Jamjuree", sans-serif';
            ctx.fillStyle = accent;
            ctx.fillText('HAC', 48, 74);
            ctx.font = '300 16px "Bai Jamjuree", sans-serif';
            ctx.fillStyle = textSecondary;
            ctx.fillText('HULT AI COLLECTIVE', 140, 60);
            ctx.font = '500 12px "Bai Jamjuree", sans-serif';
            ctx.fillStyle = textDim;
            ctx.fillText('MEMBER IDENTIFICATION', 140, 78);

            // Member ID
            ctx.font = '500 13px "Fira Mono", monospace';
            ctx.fillStyle = textDim;
            ctx.textAlign = 'right';
            ctx.fillText(profile.memberId || 'HAC-2025-0001', w - 48, 52);

            const now = new Date();
            const dateStr = `${String(now.getDate()).padStart(2,'0')}.${String(now.getMonth()+1).padStart(2,'0')}.${now.getFullYear()}`;
            ctx.font = '400 11px "Fira Mono", monospace';
            ctx.fillText('ISSUED ' + dateStr, w - 48, 72);
            ctx.textAlign = 'left';

            // Separator
            ctx.fillStyle = 'rgba(255,255,255,0.06)';
            ctx.fillRect(48, 100, w - 96, 1);

            // Avatar
            const avatarX = 48, avatarY = 124, avatarW = 140, avatarH = 175;
            ctx.fillStyle = darkPanel;
            ctx.fillRect(avatarX, avatarY, avatarW, avatarH);
            ctx.strokeStyle = 'rgba(0,212,212,0.3)';
            ctx.lineWidth = 1.5;
            ctx.strokeRect(avatarX, avatarY, avatarW, avatarH);

            function drawFields() {
                ctx.fillStyle = accent;
                ctx.fillRect(avatarX, avatarY + avatarH, avatarW, 3);
                ctx.font = '500 9px "Bai Jamjuree", sans-serif';
                ctx.fillStyle = textDim;
                ctx.textAlign = 'center';
                ctx.fillText('PHOTO ID', avatarX + avatarW / 2, avatarY + avatarH + 22);
                ctx.textAlign = 'left';

                const fields = [
                    { label: 'NAME', value: profile.name || 'HAC MEMBER' },
                    { label: 'EMAIL', value: profile.email || 'member@hac.edu' },
                    { label: 'CLEARANCE', value: profile.clearance || 'BUILDER' },
                    { label: 'DESIGNATION', value: profile.designation || 'AI COLLECTIVE MEMBER' }
                ];

                const fieldX = 228;
                let fieldY = 138;
                fields.forEach(f => {
                    ctx.font = '600 10px "Bai Jamjuree", sans-serif';
                    ctx.fillStyle = accent;
                    ctx.globalAlpha = 0.7;
                    ctx.fillText(f.label, fieldX, fieldY);
                    ctx.globalAlpha = 1;
                    ctx.font = '500 20px "Bai Jamjuree", sans-serif';
                    ctx.fillStyle = textPrimary;
                    let val = f.value;
                    while (ctx.measureText(val).width > (w - fieldX - 60) && val.length > 3) val = val.slice(0, -1);
                    if (val !== f.value) val += '…';
                    ctx.fillText(val, fieldX, fieldY + 24);
                    ctx.fillStyle = 'rgba(255,255,255,0.04)';
                    ctx.fillRect(fieldX, fieldY + 32, w - fieldX - 60, 1);
                    fieldY += 64;
                });

                // Footer
                ctx.fillStyle = 'rgba(255,255,255,0.03)';
                ctx.fillRect(0, h - 72, w, 72);
                ctx.fillStyle = 'rgba(255,255,255,0.06)';
                ctx.fillRect(0, h - 72, w, 1);
                ctx.font = '22px monospace';
                ctx.fillStyle = 'rgba(255,255,255,0.1)';
                ctx.fillText('▌▐▌▌▐▐▌▐▌▐▌▌▐▐▌▐▌▐▌▌▐▐▌', 48, h - 32);
                ctx.font = '600 12px "Bai Jamjuree", sans-serif';
                ctx.fillStyle = accent;
                ctx.textAlign = 'right';
                ctx.fillText('HULT AI COLLECTIVE', w - 48, h - 44);
                ctx.font = '400 10px "Fira Mono", monospace';
                ctx.fillStyle = textDim;
                ctx.fillText('hultaicollective.com', w - 48, h - 26);
                ctx.textAlign = 'left';

                // Border + corners
                ctx.strokeStyle = 'rgba(0,212,212,0.2)';
                ctx.lineWidth = 2;
                ctx.strokeRect(1, 1, w - 2, h - 2);
                const cl = 20;
                ctx.strokeStyle = accent;
                ctx.lineWidth = 2;
                ctx.beginPath(); ctx.moveTo(0, cl); ctx.lineTo(0, 0); ctx.lineTo(cl, 0); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(w - cl, 0); ctx.lineTo(w, 0); ctx.lineTo(w, cl); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(0, h - cl); ctx.lineTo(0, h); ctx.lineTo(cl, h); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(w - cl, h); ctx.lineTo(w, h); ctx.lineTo(w, h - cl); ctx.stroke();

                if (callback) callback(canvas);
            }

            // Try drawing avatar
            if (profile.avatar) {
                const img = new Image();
                img.crossOrigin = 'anonymous';
                img.onload = function () {
                    ctx.drawImage(img, avatarX, avatarY, avatarW, avatarH);
                    drawFields();
                };
                img.onerror = function () {
                    // Placeholder
                    ctx.fillStyle = 'rgba(14,14,14,0.8)'; ctx.fillRect(avatarX, avatarY, avatarW, avatarH);
                    ctx.font = '48px serif'; ctx.fillStyle = accent; ctx.globalAlpha = 0.4; ctx.textAlign = 'center';
                    ctx.fillText('◉', avatarX + avatarW / 2, avatarY + avatarH / 2 + 16);
                    ctx.textAlign = 'left'; ctx.globalAlpha = 1;
                    drawFields();
                };
                img.src = profile.avatar;
            } else {
                ctx.fillStyle = 'rgba(14,14,14,0.8)'; ctx.fillRect(avatarX, avatarY, avatarW, avatarH);
                ctx.font = '48px serif'; ctx.fillStyle = accent; ctx.globalAlpha = 0.4; ctx.textAlign = 'center';
                ctx.fillText('◉', avatarX + avatarW / 2, avatarY + avatarH / 2 + 16);
                ctx.textAlign = 'left'; ctx.globalAlpha = 1;
                drawFields();
            }
        }

        function downloadNamecard() {
            generateNamecard(function (canvas) {
                canvas.toBlob(function (blob) {
                    if (!blob) return;
                    const profile = loadProfile() || {};
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'HAC_NAMECARD_' + (profile.name || 'MEMBER').replace(/\s+/g, '_').toUpperCase() + '.png';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 'image/png');
            });
        }

        async function shareNamecard() {
            const profile = loadProfile() || {};
            const memberName = (profile.name || 'HAC Member').trim();
            const canvas = document.getElementById('card-export-canvas');

            // Generate card first
            await new Promise(resolve => generateNamecard(function () { resolve(); }));

            // Web Share API (native Android/iOS share)
            if (navigator.share && navigator.canShare) {
                try {
                    const blob = await new Promise(r => canvas.toBlob(r, 'image/png'));
                    const file = new File([blob], 'HAC_NAMECARD_' + memberName.replace(/\s+/g, '_') + '.png', { type: 'image/png' });
                    if (navigator.canShare({ files: [file] })) {
                        await navigator.share({
                            title: 'HAC Member Card',
                            text: "I'm " + memberName + ' — member of the Hult AI Collective ◈',
                            files: [file]
                        });
                        return;
                    }
                } catch (e) {
                    if (e.name === 'AbortError') return;
                }
            }

            // Text-only share fallback
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: 'HAC Member Card',
                        text: "I'm " + memberName + ' — member of the Hult AI Collective ◈',
                        url: window.location.origin
                    });
                    return;
                } catch (e) {
                    if (e.name === 'AbortError') return;
                }
            }

            // Clipboard fallback
            try {
                await navigator.clipboard.writeText("I'm " + memberName + ' — member of the Hult AI Collective ◈ ' + window.location.origin);
                alert('Link copied to clipboard!');
            } catch (e) {
                alert('Share not supported on this browser');
            }
        }

        // ═══════════════════════════════════════════════════════════════════════
        // INIT
        // ═══════════════════════════════════════════════════════════════════════
        function init() {
            populateDashboard();

            // Footer year
            const fy = document.getElementById('footer-year');
            if (fy) fy.textContent = new Date().getFullYear();

            // Share button
            const shareBtn = document.getElementById('share-card-btn');
            if (shareBtn) shareBtn.addEventListener('click', shareNamecard);

            // Quick links
            const linkShare = document.getElementById('link-share-card');
            if (linkShare) linkShare.addEventListener('click', function (e) { e.preventDefault(); shareNamecard(); });

            const linkDownload = document.getElementById('link-download-card');
            if (linkDownload) linkDownload.addEventListener('click', function (e) { e.preventDefault(); downloadNamecard(); });

            // If no profile, redirect to access portal
            const profile = loadProfile();
            if (!profile || !profile.profileSetupComplete) {
                // Allow viewing but show notice
                const welcomeName = document.getElementById('welcome-name');
                if (welcomeName && !profile) welcomeName.textContent = 'Guest';
            }
        }

        if (document.fonts) {
            document.fonts.ready.then(init);
        } else {
            document.addEventListener('DOMContentLoaded', init);
        }
    })();
    </script>
</body>
</html>
